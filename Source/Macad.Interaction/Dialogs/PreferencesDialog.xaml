<mmp:Dialog x:Class="Macad.Interaction.Dialogs.PreferencesDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:mmp="clr-namespace:Macad.Presentation;assembly=Macad.Presentation"
             xmlns:local="clr-namespace:Macad.Interaction.Dialogs"
             mc:Ignorable="d" 
             d:DesignWidth="800" d:DesignHeight="600" 
             Title="Preferences"
             ResizeMode="NoResize" 
             ShowInTaskbar="False" 
             Width="600" Height="500"
             Padding="0"
             SizeToContent="Manual"
             AutomationProperties.AutomationId="PreferencesDialog"
             Style="{StaticResource {x:Type mmp:Dialog}}"
             DataContext="{Binding RelativeSource={RelativeSource Self}}">
    
    <mmp:Dialog.Footer>
        <DockPanel>
            <Button DockPanel.Dock="Right"
                    Content="Close" 
                    IsDefault="True" IsCancel="True" 
                    Style="{StaticResource Macad.Styles.Button.DialogFooter}" 
                    AutomationProperties.AutomationId="CloseBtn" />

            <Button DockPanel.Dock="Right"
                    Content="Restart" 
                    Style="{StaticResource Macad.Styles.Button.DialogFooter}" 
                    Visibility="{Binding IsRestartRequired, Converter={mmp:BoolToVisibleHiddenConverter}}"
                    Command="{Binding RestartCommand}"
                    AutomationProperties.AutomationId="RestartBtn" />
            <Label DockPanel.Dock="Left"
                   Content="Some parameter changes require a restart."
                   Visibility="{Binding IsRestartRequired, Converter={mmp:BoolToVisibleCollapsedConverter}}"/>
        </DockPanel>
    </mmp:Dialog.Footer>

    <DockPanel>
        <ListBox x:Name="ParamSets"
                 DockPanel.Dock="Left"
                 ItemsSource="{Binding ParameterSets}"
                 SelectedIndex="0"
                 SelectionMode="Single"
                 BorderThickness="0"
                 Padding="0"
                 HorizontalAlignment="Left"
                 AutomationProperties.AutomationId="ParameterSetList">
            <mmp:Behaviors.Behaviors>
                <mmp:SelectionCommandBehaviour Command="{Binding SelectParameterSetCommand}" CommandParameter="{Binding SelectedItem, ElementName=ParamSets}" />
                <mmp:SelectionCommandBehaviour Command="{Binding ScrollToHomeCommand, ElementName=ParameterScrollViewer}" />
            </mmp:Behaviors.Behaviors>

            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Vertical" >
                        <TextBlock Text="{Binding Converter={x:Static local:PreferencesDialog.ParameterSetDisplayNameConverter}}"
                                   Margin="10,2"
                                   FontSize="13">
                        </TextBlock>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <TextBlock DockPanel.Dock="Top" 
                   Margin="20, 10, 10, 0"
                   FontSize="20"
                   Text="{Binding SelectedParameterSet, Converter={x:Static local:PreferencesDialog.ParameterSetDisplayNameConverter}}" />
        <Rectangle DockPanel.Dock="Top" 
                   Height="1"
                   Margin="10,0"
                   HorizontalAlignment="Stretch"
                   Fill="{StaticResource Macad.Brushes.Glyph.Disabled}"/>

        <mmp:PanningScrollViewer x:Name="ParameterScrollViewer">
            <mmp:TemplateItemsControl ItemsSource="{Binding SelectedParameterSet.Parameters}"
                                      Margin="10,10,15,10"
                                      Grid.IsSharedSizeScope="True"
                                      AutomationProperties.AutomationId="ParameterList">
                <mmp:TemplateItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="Auto" MinWidth="200" SharedSizeGroup="Name" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="20"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>

                            <Grid Grid.RowSpan="3" Grid.Column="0">
                                <Rectangle Width="2"
                                           HorizontalAlignment="Left"
                                           Fill="{StaticResource Macad.Brushes.Glyph.Disabled}"
                                           Visibility="{Binding IsOverridden, Converter={mmp:BoolToVisibleHiddenConverter}}"/>

                            </Grid>

                            <TextBlock Grid.Row="0" Grid.Column="1" 
                                       Text="{Binding DisplayName}"
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       TextAlignment="Left"
                                       VerticalAlignment="Center"/>

                            <ContentControl Grid.Row="0" Grid.Column="2" 
                                            Margin="10,0"
                                            ContentTemplateSelector="{Binding Source={x:Static local:PreferencesDialog.ParameterTemplateSelector}}"
                                            Content="{Binding}" />

                            <Button Grid.Row="0" Grid.Column="3" 
                                    Style="{StaticResource Macad.Styles.Button.Glyph}"
                                    Content="{StaticResource Macad.Geometries.Reset}" 
                                    Foreground="Transparent"
                                    Height="18"
                                    Visibility="{Binding IsOverridden, Converter={mmp:BoolToVisibleHiddenConverter}}"
                                    Command="{Binding ResetToDefaultCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type local:PreferencesDialog}}}"
                                    CommandParameter="{Binding}"
                                    ToolTip="Reset to default"/>

                            <TextBlock Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" 
                                       Margin="0,2,0,0"
                                       Text="{Binding Description}"
                                       TextWrapping="Wrap"
                                       TextAlignment="Left" />
                         </Grid>
                    </DataTemplate>
                </mmp:TemplateItemsControl.ItemTemplate>
            </mmp:TemplateItemsControl>
        </mmp:PanningScrollViewer>
    </DockPanel>

    <mmp:Dialog.Resources>
        <DataTemplate x:Key="ValueTemplate">
            <mmp:ValueEditBox MinWidth="80"
                              Value="{Binding Value}"
                              Units="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=Units}"
                              Precision="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=Precision}"
                              MinValue="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=MinValue}"
                              MaxValue="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=MaxValue}"/>
        </DataTemplate>

        <DataTemplate x:Key="NumberTemplate">
            <mmp:ValueEditBox MinWidth="100"
                              Value="{Binding Value}"
                              IncDecButtons="True"
                              Precision="0"
                              Units="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=Units}"
                              MinValue="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=MinValue}"
                              MaxValue="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=MaxValue}"
                              IncDecStep="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=IncDecStep}"/>
        </DataTemplate>

        <DataTemplate x:Key="CheckboxTemplate">
            <CheckBox IsChecked="{Binding Value}" />
        </DataTemplate>
        
        <DataTemplate x:Key="TextboxTemplate">
            <TextBox Text="{Binding Value}" 
                     MaxLines="1" 
                     MinWidth="150"/>
        </DataTemplate>

        <DataTemplate x:Key="EnumTemplate">
            <ComboBox Text="{Binding Value}"
                      IsEditable="False"
                      StaysOpenOnEdit="False"
                      HorizontalAlignment="Left"
                      MinWidth="100"
                      ItemsSource="{Binding Mode=OneTime, Converter={x:Static local:PreferencesDialog.EditorHintConverter}, ConverterParameter=EnumNames}"
                      AutomationProperties.AutomationId="{Binding Name}">
            </ComboBox>
        </DataTemplate>

        <DataTemplate x:Key="FontFamilyTemplate">
            <ComboBox Text="{Binding Value}"
                      IsEditable="True"
                      StaysOpenOnEdit="False"
                      HorizontalAlignment="Left"
                      MinWidth="150"
                      ItemsSource="{Binding Source={x:Static Fonts.SystemFontFamilies}}">
                <ComboBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </ComboBox.ItemsPanel>
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" 
                                   FontFamily="{Binding}" 
                                   FontSize="14"
                                   MinHeight="14"
                                   Height="Auto"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
        </DataTemplate>

        <DataTemplate x:Key="UnknownTemplate">
            <Label Content="(Not editable)" />
        </DataTemplate>
    </mmp:Dialog.Resources>

</mmp:Dialog>
